From d66f9aff14c6588af86c7a4b227d1eed4fb46db4 Mon Sep 17 00:00:00 2001
From: Hood Chatham <roberthoodchatham@gmail.com>
Date: Sun, 7 May 2023 12:58:34 -0700
Subject: [PATCH] Fix addFunction for js function when WebAssembly.Function is
 available

Backported from
https://github.com/emscripten-core/emscripten/pull/19306

---
 src/library_addfunction.js | 10 ----------
 test/test_other.py         | 41 ++++++++++++++++++++++++++++++++++++++
 2 files changed, 41 insertions(+), 10 deletions(-)

diff --git a/src/library_addfunction.js b/src/library_addfunction.js
index 24ebe48af..90f8c0b23 100644
--- a/src/library_addfunction.js
+++ b/src/library_addfunction.js
@@ -23,12 +23,7 @@ mergeInto(LibraryManager.library, {
   $sigToWasmTypes: function(sig) {
     var typeNames = {
       'i': 'i32',
-#if MEMORY64
       'j': 'i64',
-#else
-      // i64 values will be split into two i32s.
-      'j': 'i32',
-#endif
       'f': 'f32',
       'd': 'f64',
 #if MEMORY64
@@ -46,11 +41,6 @@ mergeInto(LibraryManager.library, {
       assert(sig[i] in typeNames, 'invalid signature char: ' + sig[i]);
 #endif
       type.parameters.push(typeNames[sig[i]]);
-#if !MEMORY64
-      if (sig[i] === 'j') {
-        type.parameters.push('i32');
-      }
-#endif
     }
     return type;
   },
-- 
2.25.1

