package:
  name: fiona
  version: 1.9.5
  # Fails with CppException std::invalid_argument: stoi: no conversion
  pinned: true
source:
  url: https://files.pythonhosted.org/packages/51/e0/71b63839cc609e1d62cea2fc9774aa605ece7ea78af823ff7a8f1c560e72/fiona-1.10.1.tar.gz
  sha256: b00ae357669460c6491caba29c2022ff0acfcbde86a95361ea8ff5cd14a86b68
test:
  imports:
    - fiona
    - fiona.fio
requirements:
  host:
    - gdal
    - geos
  run:
    - attrs
    - certifi
    - setuptools
    - six
    - click
    - cligj
      # - click-plugins  # only for fiona CLI?

build:
  vendor-sharedlib: true
  script: |
    export PACKAGE_DATA=1
    export GDAL_CONFIG=${WASM_LIBRARY_DIR}/bin/gdal-config
    export GDAL_DATA=${WASM_LIBRARY_DIR}/share/gdal
    export PROJ_LIB=${WASM_LIBRARY_DIR}/share/proj
    echo ${GDAL_CONFIG}
    echo ${GDAL_DATA}
    echo ${PROJ_LIB}
    rm tests/test_fio* # CLI tests
    rm tests/test_data_paths.py # CLI tests
    rm tests/test_datetime.py # CLI tests
    rm tests/test_vfs.py # No module named "boto3"
    rm tests/test_env.py # No module named "boto3"

    mkdir fiona-tests
    mv tests fiona-tests
    tar -cf ${DISTDIR}/fiona-tests.tar fiona-tests

about:
  home: http://github.com/Toblerity/Fiona
  PyPI: https://pypi.org/project/fiona
  summary: Fiona reads and writes spatial data files
  license: BSD-3-Clause
# Note: this package needs to be manually upgraded to the next version
