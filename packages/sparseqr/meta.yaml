package:
  name: sparseqr
  version: 1.2.1
  top-level:
    - sparseqr

source:
  # PyPI release has invalid setup.py (missing cffi modules information) so we use github archive instead.
  sha256: 9ee4901f74c5f066db15118cd4b84c56aaeb0ad08f9c295463ac1e32c38da88c
  url: https://files.pythonhosted.org/packages/bd/57/0d69f46cb38f21f5c5be105db0a0d8ae1fc7bfe494500d830350c25eb0b7/sparseqr-1.2.1.tar.gz

requirements:
  run:
    - pycparser
    - cffi
    - numpy
    - scipy
    - suitesparse
  host:
    - suitesparse
build:
  script: |
    # FIXME: We are not dealing with poetry build system correctly.
    #        So for now remove `pyproject.toml` to force pypabuild to use setup.py
    rm -f pyproject.toml
    sed -i "s@include_dirs = \[\]@include_dirs = ['\\${WASM_LIBRARY_DIR}/include']@" sparseqr/sparseqr_gen.py
    sed -i "s@library_dirs = \[\]@library_dirs = ['\\${WASM_LIBRARY_DIR}/lib']@" sparseqr/sparseqr_gen.py
