package:
  name: sparseqr
  version: 1.4.1
  top-level:
    - sparseqr

source:
  # PyPI release has invalid setup.py (missing cffi modules information) so we use github archive instead.
  sha256: 3c1f0ad101f601f780af9ddb0d06e78d4ffe8dd9605f5fd2c73e4cbf4de9b6b9
  url: https://files.pythonhosted.org/packages/0b/5a/032078d1c456b679f1d1d3f654a6c7392e215c3f6e2479cf1bec14f7469c/sparseqr-1.4.1.tar.gz

requirements:
  run:
    - pycparser
    - cffi
    - numpy
    - scipy
    - suitesparse
  host:
    - suitesparse
build:
  script: |
    # FIXME: We are not dealing with poetry build system correctly.
    #        So for now remove `pyproject.toml` to force pypabuild to use setup.py
    rm -f pyproject.toml
    sed -i "s@include_dirs = \[\]@include_dirs = ['\\${WASM_LIBRARY_DIR}/include']@" sparseqr/sparseqr_gen.py
    sed -i "s@library_dirs = \[\]@library_dirs = ['\\${WASM_LIBRARY_DIR}/lib']@" sparseqr/sparseqr_gen.py
  ldflags: |
    -lsuitesparseconfig
    -lamd
    -lcamd
    -lccolamd
    -lcolamd
    -lcholmod
    -lmetis
about:
  home: https://github.com/yig/PySPQR
  license: CC0-1.0
