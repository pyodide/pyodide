From bd9e0f6fa7e51634fe8f9b9315ab3ad4da8bdc9c Mon Sep 17 00:00:00 2001
From: Hood <hood@mit.edu>
Date: Sat, 13 Nov 2021 20:53:19 -0800
Subject: [PATCH] Fix getters, setters, and some METH_NOARGS signatures in
 nditer_pywrap

---
 numpy/core/src/multiarray/nditer_pywrap.c | 64 +++++++++++------------
 1 file changed, 32 insertions(+), 32 deletions(-)

diff --git a/numpy/core/src/multiarray/nditer_pywrap.c b/numpy/core/src/multiarray/nditer_pywrap.c
index 25d21025e..0c939bf18 100644
--- a/numpy/core/src/multiarray/nditer_pywrap.c
+++ b/numpy/core/src/multiarray/nditer_pywrap.c
@@ -1228,7 +1228,7 @@ npyiter_resetbasepointers(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_reset(NewNpyArrayIterObject *self)
+npyiter_reset(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1265,7 +1265,7 @@ npyiter_reset(NewNpyArrayIterObject *self)
  * copied.
  */
 static PyObject *
-npyiter_copy(NewNpyArrayIterObject *self)
+npyiter_copy(NewNpyArrayIterObject *self, PyObject *unused)
 {
     NewNpyArrayIterObject *iter;
 
@@ -1301,7 +1301,7 @@ npyiter_copy(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_iternext(NewNpyArrayIterObject *self)
+npyiter_iternext(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter != NULL && self->iternext != NULL &&
                         !self->finished && self->iternext(self->iter)) {
@@ -1354,7 +1354,7 @@ npyiter_remove_axis(NewNpyArrayIterObject *self, PyObject *args)
 }
 
 static PyObject *
-npyiter_remove_multi_index(NewNpyArrayIterObject *self)
+npyiter_remove_multi_index(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1379,7 +1379,7 @@ npyiter_remove_multi_index(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_enable_external_loop(NewNpyArrayIterObject *self)
+npyiter_enable_external_loop(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1404,7 +1404,7 @@ npyiter_enable_external_loop(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_debug_print(NewNpyArrayIterObject *self)
+npyiter_debug_print(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter != NULL) {
         NpyIter_DebugPrint(self->iter);
@@ -1419,7 +1419,7 @@ npyiter_debug_print(NewNpyArrayIterObject *self)
 NPY_NO_EXPORT PyObject *
 npyiter_seq_item(NewNpyArrayIterObject *self, Py_ssize_t i);
 
-static PyObject *npyiter_value_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_value_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
 
@@ -1455,7 +1455,7 @@ static PyObject *npyiter_value_get(NewNpyArrayIterObject *self)
     return ret;
 }
 
-static PyObject *npyiter_operands_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_operands_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
 
@@ -1484,7 +1484,7 @@ static PyObject *npyiter_operands_get(NewNpyArrayIterObject *self)
     return ret;
 }
 
-static PyObject *npyiter_itviews_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_itviews_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
 
@@ -1515,7 +1515,7 @@ static PyObject *npyiter_itviews_get(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_next(NewNpyArrayIterObject *self)
+npyiter_next(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter == NULL || self->iternext == NULL ||
                 self->finished) {
@@ -1542,7 +1542,7 @@ npyiter_next(NewNpyArrayIterObject *self)
     return npyiter_value_get(self);
 };
 
-static PyObject *npyiter_shape_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_shape_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
     npy_intp idim, ndim, shape[NPY_MAXDIMS];
@@ -1568,7 +1568,7 @@ static PyObject *npyiter_shape_get(NewNpyArrayIterObject *self)
     return NULL;
 }
 
-static PyObject *npyiter_multi_index_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_multi_index_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
     npy_intp idim, ndim, multi_index[NPY_MAXDIMS];
@@ -1613,7 +1613,7 @@ static PyObject *npyiter_multi_index_get(NewNpyArrayIterObject *self)
 }
 
 static int
-npyiter_multi_index_set(NewNpyArrayIterObject *self, PyObject *value)
+npyiter_multi_index_set(NewNpyArrayIterObject *self, PyObject *value, void *unused)
 {
     npy_intp idim, ndim, multi_index[NPY_MAXDIMS];
 
@@ -1668,7 +1668,7 @@ npyiter_multi_index_set(NewNpyArrayIterObject *self, PyObject *value)
     }
 }
 
-static PyObject *npyiter_index_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_index_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL || self->finished) {
         PyErr_SetString(PyExc_ValueError,
@@ -1687,7 +1687,7 @@ static PyObject *npyiter_index_get(NewNpyArrayIterObject *self)
     }
 }
 
-static int npyiter_index_set(NewNpyArrayIterObject *self, PyObject *value)
+static int npyiter_index_set(NewNpyArrayIterObject *self, PyObject *value, void *unused)
 {
     if (value == NULL) {
         PyErr_SetString(PyExc_AttributeError,
@@ -1726,7 +1726,7 @@ static int npyiter_index_set(NewNpyArrayIterObject *self, PyObject *value)
     }
 }
 
-static PyObject *npyiter_iterindex_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_iterindex_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL || self->finished) {
         PyErr_SetString(PyExc_ValueError,
@@ -1737,7 +1737,7 @@ static PyObject *npyiter_iterindex_get(NewNpyArrayIterObject *self)
     return PyInt_FromLong(NpyIter_GetIterIndex(self->iter));
 }
 
-static int npyiter_iterindex_set(NewNpyArrayIterObject *self, PyObject *value)
+static int npyiter_iterindex_set(NewNpyArrayIterObject *self, PyObject *value, void *unused)
 {
     npy_intp iterindex;
 
@@ -1770,7 +1770,7 @@ static int npyiter_iterindex_set(NewNpyArrayIterObject *self, PyObject *value)
     return 0;
 }
 
-static PyObject *npyiter_iterrange_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_iterrange_get(NewNpyArrayIterObject *self, void *unused)
 {
     npy_intp istart = 0, iend = 0;
     PyObject *ret;
@@ -1794,7 +1794,7 @@ static PyObject *npyiter_iterrange_get(NewNpyArrayIterObject *self)
     return ret;
 }
 
-static int npyiter_iterrange_set(NewNpyArrayIterObject *self, PyObject *value)
+static int npyiter_iterrange_set(NewNpyArrayIterObject *self, PyObject *value, void *unused)
 {
     npy_intp istart = 0, iend = 0;
 
@@ -1836,7 +1836,7 @@ static int npyiter_iterrange_set(NewNpyArrayIterObject *self, PyObject *value)
     return 0;
 }
 
-static PyObject *npyiter_has_delayed_bufalloc_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_has_delayed_bufalloc_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1852,7 +1852,7 @@ static PyObject *npyiter_has_delayed_bufalloc_get(NewNpyArrayIterObject *self)
     }
 }
 
-static PyObject *npyiter_iterationneedsapi_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_iterationneedsapi_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1868,7 +1868,7 @@ static PyObject *npyiter_iterationneedsapi_get(NewNpyArrayIterObject *self)
     }
 }
 
-static PyObject *npyiter_has_multi_index_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_has_multi_index_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1884,7 +1884,7 @@ static PyObject *npyiter_has_multi_index_get(NewNpyArrayIterObject *self)
     }
 }
 
-static PyObject *npyiter_has_index_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_has_index_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1900,7 +1900,7 @@ static PyObject *npyiter_has_index_get(NewNpyArrayIterObject *self)
     }
 }
 
-static PyObject *npyiter_dtypes_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_dtypes_get(NewNpyArrayIterObject *self, void *unused)
 {
     PyObject *ret;
 
@@ -1929,7 +1929,7 @@ static PyObject *npyiter_dtypes_get(NewNpyArrayIterObject *self)
     return ret;
 }
 
-static PyObject *npyiter_ndim_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_ndim_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1940,7 +1940,7 @@ static PyObject *npyiter_ndim_get(NewNpyArrayIterObject *self)
     return PyInt_FromLong(NpyIter_GetNDim(self->iter));
 }
 
-static PyObject *npyiter_nop_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_nop_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1951,7 +1951,7 @@ static PyObject *npyiter_nop_get(NewNpyArrayIterObject *self)
     return PyInt_FromLong(NpyIter_GetNOp(self->iter));
 }
 
-static PyObject *npyiter_itersize_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_itersize_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_ValueError,
@@ -1962,7 +1962,7 @@ static PyObject *npyiter_itersize_get(NewNpyArrayIterObject *self)
     return PyInt_FromLong(NpyIter_GetIterSize(self->iter));
 }
 
-static PyObject *npyiter_finished_get(NewNpyArrayIterObject *self)
+static PyObject *npyiter_finished_get(NewNpyArrayIterObject *self, void *unused)
 {
     if (self->iter == NULL || !self->finished) {
         Py_RETURN_FALSE;
@@ -2335,7 +2335,7 @@ npyiter_ass_subscript(NewNpyArrayIterObject *self, PyObject *op,
 }
 
 static PyObject *
-npyiter_enter(NewNpyArrayIterObject *self)
+npyiter_enter(NewNpyArrayIterObject *self, PyObject *unused)
 {
     if (self->iter == NULL) {
         PyErr_SetString(PyExc_RuntimeError, "operation on non-initialized iterator");
@@ -2346,7 +2346,7 @@ npyiter_enter(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_close(NewNpyArrayIterObject *self)
+npyiter_close(NewNpyArrayIterObject *self, PyObject *unused)
 {
     NpyIter *iter = self->iter;
     int ret;
@@ -2364,10 +2364,10 @@ npyiter_close(NewNpyArrayIterObject *self)
 }
 
 static PyObject *
-npyiter_exit(NewNpyArrayIterObject *self, PyObject *args)
+npyiter_exit(NewNpyArrayIterObject *self, PyObject *unused)
 {
     /* even if called via exception handling, writeback any data */
-    return npyiter_close(self);
+    return npyiter_close(self, unused);
 }
 
 static PyMethodDef npyiter_methods[] = {
-- 
2.17.1

