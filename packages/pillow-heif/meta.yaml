package:
  name: pillow-heif
  version: 0.20.0
source:
  url: https://files.pythonhosted.org/packages/eb/82/d8eb6a8b5d7dd88e887f977eb6f5deedafd85be53343dcc761f363658db8/pillow_heif-0.20.0.tar.gz
  sha256: cac19c4434ab776f833160d61f3cbeddb347bd8ed2f82205b243eba5c572fa33
  patches: # temp disable for debug
    - patches/Set-LIBHEIF_ROOT-correctly.patch
requirements:
  run:
    - cffi
    - Pillow
    - libheif
  host:
    - cffi
    - libheif
build:
  # Don't use the header from libheif, use the one pillow-heif provides
  # cflags: -I
  # ldflags: -L${WASM_LIBRARY_DIR}/lib
  cflags: -I./libheif
  cxxflags: -I./libheif
  ldflags: -L./libheif -L./libheif/lib
  script: |
    # do not use the header from libheif, use the one pillow-heif provides
    # so we unset the WASM_LIBRARY_DIR environment variable
      unset WASM_LIBRARY_DIR
      # debug: list current directory
      echo $PWD
      echo $LIBHEIF_ROOT
      echo "AGRIYA DEBUG"
      ls -la
      export LIBHEIF_ROOT=$PWD
      echo "LIBHEIF_ROOT: $LIBHEIF_ROOT"
      # cflags, cppflags, ldflags are respected by the build, let's use them
      export CFLAGS="$CFLAGS -I$LIBHEIF_ROOT/libheif/include"
      export CPPFLAGS="$CPPFLAGS -I$LIBHEIF_ROOT/libheif/include"
      export LDFLAGS="$LDFLAGS -L$LIBHEIF_ROOT/libheif/lib"
      # !!! packages/pillow-heif/build/pillow-heif-0.20.0/libheif/include/heif.h is here after the patch
test:
  imports:
    - pillow_heif
about:
  home: https://github.com/bigcat88/pillow_heif
  PyPI: https://pypi.org/project/pillow_heif
  summary: Python 3.6+ interface to libheif library
  license: LGPL-2.1
