package:
  name: suitesparse
  version: 1.0.0

source:
  sha256: 1480acb174081599604f5e894bbe8a1a551de5904eef6ea67f33b25f884cd74f
  url: https://gabrielfougeron.github.io/files/suitesparse.zip
  extract_dir: suitesparse

requirements:
  #build:
    #- CLAPACK
  run:
    - CLAPACK

build:
  sharedlibrary: true
  # set linker and C flags to error on anything to do with function declarations being wrong.
  # In webassembly, any conflicts mean that a randomly selected 50% of calls to the function
  # will fail. Better to fail at compile or link time.
  ldflags: |
    -Wl,--fatal-warnings
    -sSIDE_MODULE=1
  script: |
    emmake make BLAS="-L$PYODIDE_ROOT/packages/CLAPACK/dist/lib -lblas" LAPACK="-L$PYODIDE_ROOT/packages/CLAPACK/dist/lib/ -llapack"
    mkdir -p dist/lib
    mkdir -p dist/include
    mkdir -p dist/bin
    cp -R bin/* dist/bin
    cp -R include/* dist/include
    cp -R lib/*  dist/lib
  #script: |
    #emmake make BLAS="-L$PYODIDE_ROOT/packages/CLAPACK/dist/lib -lblas" LAPACK="-L$PYODIDE_ROOT/packages/CLAPACK/dist/lib/ -llapack"
    #mkdir -p dist/bin
    #mkdir -p dist/include
    #mkdir -p dist/lib
    #cp -R bin/* dist/bin
    #cp -R include/* dist/include
    #emcc -LL$PYODIDE_ROOT/packages/suitesparse/build/suitesparse-1.0.0/lib -shared -Wl,-soname -Wl,libsuitesparseconfig.so.5 -Wl,-rpath,'$ORIGIN' -Wl,-z,origin SuiteSparse_config.o -o /mnt/c/Programmation/suitesparse/lib/libsuitesparseconfig.so.5.10.1 -lm -lrt      
    



