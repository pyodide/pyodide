package:
  name: pyxel
  version: 2.3.18
  tag:
    - rust
source:
  url: https://github.com/kitao/pyxel/archive/refs/tags/v2.3.18.tar.gz
  sha256: acea88bb99078053d012d02a5caf104e78940eeaad853592bb3e8f7a1ddb2dec
build:
  script: |
    # copy pyproject.toml and python source code to the build directory
    cp -r python/* .

    # fix relative paths in pyproject.toml
    sed -i 's|"../|"./|g' pyproject.toml

    # LICENSE file is duplicated, which causes an error
    rm -f LICENSE

    embuilder build sdl2 --pic
    export RUSTFLAGS="\
      $RUSTFLAGS \
      -C link-arg=-sUSE_SDL=2 \
      -C link-arg=-lSDL2 \
    "

requirements:
  executable:
    - rustup
  constraint:
    - maturin < 1.8
test:
  imports:
    - pyxel
about:
  home: https://github.com/kitao/pyxel
  PyPI: https://pypi.org/project/pyxel/
  summary: A retro game engine for Python
  license: MIT
